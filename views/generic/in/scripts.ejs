<script>
  //Takes input in currency entered and converts it to Satoshis
  var currencyInput = function(amount) {
    var satoshis = 0;
    var num_amount = parseFloat(amount);
    var btc_to_usd = <%= bitbox_btc_to_usd %>
    var satoshi_to_btc = 0.00000001;
    var currency = $.cookie('currency-display');
    if (currency == "usd"){
      satoshis = parseInt( (num_amount / btc_to_usd) / satoshi_to_btc);
    }
    else if (currency == "bitcoin"){
      satoshis = parseInt(num_amount / satoshi_to_btc);
    } else {
      //If its in satoshis we don't have to do anything
      satoshis = parseInt(num_amount);
    }
    console.log("Returning: " + satoshis);
    return satoshis;
  };

  //Takes Satoshis as a number and outputs the currency we display
  var currencyOutput = function(bits) {
    var outStr = "";
    var btc_to_usd = <%= bitbox_btc_to_usd %>;
    var satoshi_to_btc = 0.00000001;
    var currency = $.cookie('currency-display');
    console.log("CURRENCY IS " + currency);
    if (currency == "usd") {
      var total = (bits*satoshi_to_btc*parseFloat(btc_to_usd)).toFixed(2);
      console.log("!Converting to USD rate: " + btc_to_usd);
      outStr = total;
    } else if (currency == "satoshi") {
      console.log("Converting to Satoshi");
      outStr = bits;
    } else {
      console.log("Defaulting to BTC");
      outStr = (bits*satoshi_to_btc).toFixed(8);
    }
    console.log("Output: " + outStr);
    return outStr;
  };

  var conversion_factor = 0;
  var currency = $.cookie('currency-display');
  var name = "";
  if (currency == "usd") {
    var btc_to_usd = <%= bitbox_btc_to_usd %>;
    conversion_factor = (1.0/0.00000001)*btc_to_usd;
    name = "USD";
  } else if (currency == "bitcoin") {
    conversion_factor = (1.0/0.00000001);
    name = "BTC";
  } else {
    conversion_factor = 1.0;
    name = "Satoshi";
  }
  $("body").find(".currency").each(function () {
    //  parsing satoshis
    var val = parseInt($(this).html());
    val = currencyOutput(val);
    $(this).html(val);
    console.log("value: " + val);
  });
  $("body").find(".denomination").each(function () {
    //  parsing satoshis
    $(this).html(name);
  });
  //Convert all -1 to n/a
  /*$("#track-table").find("td:nth-child(7)").each(function () {
    var val = parseInt($(this).html());
    if (val < 0 ) {
      $(this).html("n/a");
    }
  });*/
</script>
